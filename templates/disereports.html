{% extends 'base.html' %}
{% block page_title %} DISE Ad-hoc Reports {% endblock %}

{% block content %}
<div class="container">
  <h1 class="heading-primary brand-purple" id="top">Reports</h1>
</div>

<div class="center-text">
  <form class="form-base">
    <div class="heading-section-block">
      <div>
        <div class="col-50-flt">
          <label class="label-inline bold">Academic Year</label>
          <select id="adhoc-dise-acyear">
            <option value='10-11'>2010-2011</option>
            <option value='11-12'>2011-2012</option>
            <option value='12-13'>2012-2013</option>
            <option value='13-14'>2013-2014</option>
            <option value='14-15'>2014-2015</option>
          </select>
        </div>
        <div class="col-50-flt">
          <label class="label-inline bold">Admin Level</label>
          <select id="adhoc-dise-admin">
            <option value=''>Select an admin level</option>
            <!-- <option value='cluster'>Cluster</option>
            <option value='block'>Block</option> -->
            <option value='district'>District</option>
            <option value='mp'>Parliamentary Constitution (MP)</option>
            <option value='mla'>Assembly Constitution (MLA)</option>
          </select>
        </div>
      </div>
    </div>
  </form>
</div>


<section>
  <div class="center-text">
    <h2 class="heading-section" id="reports"><span id="heading-acyear" style="display:none"></span> Reports</h2>
  </div>
</section>

<div class="container">
  <div class="reports-list" style="display:none">
    <table class="table-base" id="reports-table">
      <thead class="table-base-heading">
        <tr>
          <th>Name</th>
          <th>Infrastructure</th>
          <th>Demographics</th>
          <th>Finance</th>
      </tr>
      </thead>
      <tbody>
      </tbody>
    </table>

  </div>

  <div class="warning-text">Please choose admin level and academic year above.</div>
  <div class="clearfix"></div>
</div>


<div class="backToTop">
  <a href="#top">Back to top</a>
</div>

{% endblock %}

{% block endbody %}
<script type="text/javascript">
  var $reports_table = $('#reports-table');

  var lists = {
    'mp': ["Tumkur", "Bangalore_Rural", "Shimoga", "Mandya", "Raichur", "Gulbarga", "Bangalore_North", "Hassan", "Dharwad", "Kolar", "Koppal", "Belgaum", "Mysore", "Chikkodi", "Bidar", "Bellary", "Haveri", "Bagalkot", "Bangalore_Central", "Bangalore_South", "Udupi_Chikmagalur", "Bijapur", "Uttara_Kannada", "Chikkballapur", "Dakshina_Kannada", "Chamarajanagar", "Chitradurga", "Davanagere"],
    'mla': ["Sindgi", "Homnabad", "Anekal", "Sirsi", "Rajaji_Nagar", "Indi", "Belgaum_Uttar", "Hungund", "Kagwad", "T.Narasipur", "Gandhi_Nagar", "Maddur", "Shimoga", "Chittapur", "Sidlaghatta", "Mandya", "Bommanahalli", "Kampli", "Nippani", "Tumkur_City", "Yemkanmardi", "Yelburga", "Tumkur_Rural", "Magadi", "Hanur", "Jamkhandi", "Raichur", "Navalgund", "Nagthan", "Nargund", "Arkalgud", "Malleshwaram", "Nanjangud", "Hiriyur", "Shrirangapattana", "Kundapura", "Molakalmuru", "Kunigal", "Tarikere", "Basavanagudi", "Bijapur_City", "Shiggaon", "Sagar", "Jagalur", "Shahapur", "Ranibennur", "Hassan", "Chincholi", "Gulbarga_Uttar", "Shikaripura", "Koratagere", "Hubli-Dharwad-East", "Narasimharaja", "Dharwad", "Kolar", "Belur", "Byadgi", "Nelamangala", "Shimoga_Rural", "Koppal", "Mahadevapura", "Pulakeshinagar", "Padmanaba_Nagar", "Rajarajeshwarinagar", "Kolar_Gold_Field", "Gokak", "Belthangady", "Hosakote", "Tiptur", "Madhugiri", "Bidar", "Chamaraja", "Arsikere", "Virajpet", "Gauribidanur", "Devadurga", "Ramdurg", "Malur", "Chikkodi-Sadalga", "Puttur", "Kundgol", "B.T.M._Layout", "Channapatna", "Bellary", "Basavana_Bagevadi", "Ron", "Challakere", "Krishnaraja", "Sorab", "Afzalpur", "Holenarasipur", "Sandur", "Shravanabelagola", "Hagaribommanahalli", "Kapu", "Sedam", "Lingsugur", "Maski", "Khanapur", "Kudligi", "Chintamani", "Belgaum_Dakshin", "Channagiri", "Chiknayakanhalli", "Haveri", "Hukkeri", "Pavagada", "Govindraj_Nagar", "Byndoor", "Bagalkot", "Chikmagalur", "Bagepalli", "Muddebihal", "Kushtagi", "Karwar", "Babaleshwar", "Raybag", "Ramanagaram", "Davanagere_North", "Varuna", "Bantval", "Kudachi", "Kanakagiri", "Devar_Hippargi", "Mulbagal", "Sarvagnanagar", "Gubbi", "Nagamangala", "Hebbal", "Hangal", "Bangalore_South", "Mudhol", "Arabhavi", "Yelahanka", "Mangalore_City_North", "Turuvekere", "Madikeri", "Kollegal", "Sullia", "Karkal", "Bhadravati", "Gundlupet", "Udupi", "Hubli-Dharwad-West", "C.V._Raman_Nagar", "Doddaballapur", "Melukote", "Malavalli", "Harapanahalli", "Basavakalyan", "Hubli-Dharwad-Central", "Bellary_City", "Mahalakshmi_Layout", "Yadgir", "Mudigere", "Yeshvanthapura", "Gadag", "Hirekerur", "Mangalore_City_South", "Tirthahalli", "Sakleshpur", "Moodabidri", "Vijay_Nagar", "Shanti_Nagar", "Gulbarga_Dakshin", "Kumta", "Raichur_Rural", "Jevargi", "Piriyapatna", "Athani", "Krishnarajpet", "Sira", "Shirahatti", "Belgaum_Rural", "Chamrajpet", "Chikkaballapur", "Davanagere_South", "Chamarajanagar", "Terdal", "Sringeri", "Chitradurga", "Srinivaspur", "Kanakapura", "Aland", "Kalghatgi", "Sindhanur", "Krishnarajanagara", "Hunsur", "Heggadadevankote", "Bhatkal", "Shorapur", "Siruguppa", "Gulbarga_Rural", "Vijayanagara", "Kadur", "Gangawati", "Mangalore", "Devanahalli", "Byatarayanapura", "Bailhongal", "Chamundeshwari", "Hosadurga", "Gurmitkal", "Badami", "Holalkere", "Bangarapet", "Shivajinagar", "Harihar", "Bhalki", "Bidar_South", "Kittur", "Mayakonda", "Dasarahalli", "Chickpet", "K.R._Pura", "Manvi", "Hadagalli", "Aurad", "Jayanagar", "Bilgi", "Honnali", "Saundatti_Yellamma"]
  }
  var fillAdmin = function(acyear, adminlevel) {
    var url_base = 'https://klp.org.in/public/adhoc-dise-reports',
        url = url_base + '/reports_dise_' + acyear.replace('-', ''),
        dise_base = 'https://dise.klp.org.in/api/';

    $reports_table.find('tbody').html('');

    if (adminlevel === 'cluster') {
    } else if (adminlevel === 'block') {
    } else if (adminlevel === 'district') {
      $.getJSON(dise_base + acyear + '/district/?basic=yes', function(response) {
        $.each(response.results.features, function(key, val) {
          var district_name = val.properties.district,
              district_slug = district_name.replace(' ', '_');

          $reports_table.find('tbody')
            .append($('<tr>'))
              .append($('<td>')
                // name
                .text(district_name)
              )
              .append($('<td>')
                .append($('<a>')
                  .attr('href', url + '/district/infrastructure/' + district_slug + '_english.pdf')
                  .text('English')
                )
                .append(' | ')
                .append($('<a>')
                  .attr('href', url + '/district/infrastructure/' + district_slug + '_kannada.pdf')
                  .text('Kannada')
                )
              )
              .append($('<td>')
                .append($('<a>')
                  .attr('href', url + '/district/demographics/' + district_slug + '_english.pdf')
                  .text('English')
                )
                .append(' | ')
                .append($('<a>')
                  .attr('href', url + '/district/demographics/' + district_slug + '_kannada.pdf')
                  .text('Kannada')
                )
              )
              .append($('<td>')
                .append($('<a>')
                  .attr('href', url + '/district/finance/' + district_slug + '_english.pdf')
                  .text('English')
                )
                .append(' | ')
                .append($('<a>')
                  .attr('href', url + '/district/finance/' + district_slug + '_kannada.pdf')
                  .text('Kannada')
                )
              )
        })
      });
    } else if (adminlevel === 'mp') {
      $.each(lists['mp'].sort(), function(idx, val) {
        $reports_table.find('tbody')
          .append($('<tr>'))
            .append($('<td>')
              // name
              .text(val)
            )
            .append($('<td>')
              .append($('<a>')
                .attr('href', url + '/mp/infrastructure/' + val + '_english.pdf')
                .text('English')
              )
              .append(' | ')
              .append($('<a>')
                .attr('href', url + '/mp/infrastructure/' + val + '_kannada.pdf')
                .text('Kannada')
              )
            )
            .append($('<td>')
              .append($('<a>')
                .attr('href', url + '/mp/demographics/' + val + '_english.pdf')
                .text('English')
              )
              .append(' | ')
              .append($('<a>')
                .attr('href', url + '/mp/demographics/' + val + '_kannada.pdf')
                .text('Kannada')
              )
            )
            .append($('<td>')
              .append($('<a>')
                .attr('href', url + '/mp/finance/' + val + '_english.pdf')
                .text('English')
              )
              .append(' | ')
              .append($('<a>')
                .attr('href', url + '/mp/finance/' + val + '_kannada.pdf')
                .text('Kannada')
              )
            )
      })
    } else if (adminlevel === 'mla') {
      $.each(lists['mla'].sort(), function(idx, val) {
        $reports_table.find('tbody')
          .append($('<tr>'))
            .append($('<td>')
              // name
              .text(val)
            )
            .append($('<td>')
              .append($('<a>')
                .attr('href', url + '/mla/infrastructure/' + val + '_english.pdf')
                .text('English')
              )
              .append(' | ')
              .append($('<a>')
                .attr('href', url + '/mla/infrastructure/' + val + '_kannada.pdf')
                .text('Kannada')
              )
            )
            .append($('<td>')
              .append($('<a>')
                .attr('href', url + '/mla/demographics/' + val + '_english.pdf')
                .text('English')
              )
              .append(' | ')
              .append($('<a>')
                .attr('href', url + '/mla/demographics/' + val + '_kannada.pdf')
                .text('Kannada')
              )
            )
            .append($('<td>')
              .append($('<a>')
                .attr('href', url + '/mla/finance/' + val + '_english.pdf')
                .text('English')
              )
              .append(' | ')
              .append($('<a>')
                .attr('href', url + '/mla/finance/' + val + '_kannada.pdf')
                .text('Kannada')
              )
            )
      })
    }
  }

  $('#adhoc-dise-acyear').select2({
    minimumResultsForSearch: Infinity
  }).on('change', function(e) {
    var admin = $('#adhoc-dise-admin').val();
    if(admin !== '') {
      $('.warning-text').hide();
      $('.reports-list').show();
      $('#heading-acyear').show().html('20' + e.val);
      fillAdmin(e.val, admin);
    }
  });
  $('#adhoc-dise-admin').select2({
    minimumResultsForSearch: Infinity
  }).on('select2-selecting', function(e) {
    console.log(e);

    var acyear = $('#adhoc-dise-acyear').val();

    if(!acyear) {
      alert('Please select an academic year');
      return false;
    } else {
      $('.warning-text').hide();
      $('.reports-list').show();
      fillAdmin(acyear, e.val);
    }
  });
</script>
{% endblock endbody %}
